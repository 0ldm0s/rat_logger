# 更新日志

本文档记录了 rat_logger 的所有重要更改。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
本项目遵循 [语义化版本](https://semver.org/spec/v2.0.0.html)。

## [未发布]

## [0.2.7]

### 修复
- **日志系统多次运行失效**: 修复程序多次运行时日志系统失效的关键问题
- **全局状态管理**: 改进Release模式下的全局日志器状态管理，确保正确重新初始化
- **资源清理**: 添加ProcessorManager的Drop实现，确保工作线程正确清理
- **批处理优化**: 调整批处理默认配置，提升日志输出可靠性

### 改进
- **批处理配置**: 批量大小从8KB降至2KB，间隔从100ms降至25ms，提高输出及时性
- **API优化**: 将init方法重命名为init_global_logger，提供更清晰的语义
- **文档更新**: 更新README.md，添加批处理配置建议和不同使用场景的示例
- **兼容性**: 保持向后兼容，同时提供更好的开发体验

### 技术细节
- 修复了Logger全局状态管理中的竞态条件
- 优化了批处理逻辑，避免程序快速退出时日志丢失
- 改进了错误处理和资源清理机制

## [0.2.4]

### 新增
- **格式配置功能**: 为终端和文件处理器添加自定义格式配置支持
- **开发模式重新初始化**: 实现安全的日志器重新初始化机制，带有警告提示
- **LoggerBuilder API改进**: 新增 `add_terminal_with_config()` 方法，支持带配置的终端处理器
- **FileConfig格式化**: 为FileConfig添加format字段，支持文件输出的自定义格式
- **示例重构**: 将原来的format_example.rs拆分为三个专门的示例文件

### 改进
- **全局日志器管理**: 从OnceCell改为Lazy<Mutex<Option<...>>>以支持重新初始化
- **格式化器选择逻辑**: 添加灵活的格式化器选择，支持默认格式、自定义格式和颜色格式
- **开发模式警告**: 实现开发模式下的安全警告机制，提醒用户仅在开发时使用重新初始化

### 新增文件
- `examples/term_format_example.rs` - 专门展示终端格式和颜色配置
- `examples/file_format_example.rs` - 展示文件格式配置，包括JSON格式
- `examples/macro_format_example.rs` - 展示宏与格式配置的结合使用

### 修复
- 修复所有示例和测试文件中FileConfig缺失format字段的问题
- 修复zerg_overmind和test_client项目中的编译错误

## [0.2.3]

### 新增
- **架构重构**: 完全重写为异步广播架构，移除旧的同步架构
- **开发模式**: 新增开发模式功能，便于调试和学习
- **性能优化**: 终端处理器性能提升6倍，大幅改善整体性能
- **LoggerBuilder改进**: 统一的构建器接口，支持更灵活的配置
- **示例更新**: 所有示例都添加开发模式和生产环境使用警告
- **文档完善**: 更新README和使用指南，添加多语言支持

### 性能提升
- 终端输出: **2,264,813 消息/秒** - 提升5.6倍
- 文件输出: **2,417,040 消息/秒** - 提升5.9倍
- 终端+文件: **1,983,192 消息/秒** - 提升3.9倍
- 多线程环境: **3,538,831 消息/秒** - 提升14.7倍
- 不同日志级别: **4.3M-4.7M 消息/秒** - 提升2.5-5.6倍

## [0.2.2]

### 修复
- 修复编译错误和依赖问题
- 改进错误处理机制
- 优化内存使用

## [0.2.1]

### 修复
- 修复编译错误和依赖问题
- 改进错误处理机制
- 优化内存使用

## [0.2.0]

### 新增
- 升级到 Rust 2024 Edition
- 更新依赖项到最新版本
- 性能优化和稳定性改进
- 发布到 crates.io
- 改进文档和示例

## [0.1.0]

### 新增
- 初始版本发布
- 生产者-消费者架构实现
- 支持基本日志记录功能
- 文件和网络输出支持
- LZ4 压缩功能
- 线程安全保证
- 日志宏支持
- 分层配置系统
- 跨平台优化

---

## 版本说明

- **主版本号**: 不兼容的 API 更改
- **次版本号**: 向下兼容的功能新增
- **修订号**: 向下兼容的问题修复

## 性能测试说明

所有性能测试均在 MacBook Air M1 本机环境下进行，使用 release 模式编译。
性能数据仅供参考，实际性能可能因硬件配置、系统环境和使用场景而异。